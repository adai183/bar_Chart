<!DOCTYPE html>
<meta charset="utf-8">

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js"></script>
<style>
body{
	background-color: black;
}
.question-container {
margin:2% 0 5% 0;
text-align: center;
}

.question {
	color: white;
}

.chart-container {
display: none;
}

.label {
	color: white;
	font-weight: 900;
	font-size: 1.9em;
	top: 80%;
	width: 21%;
	text-align: center;
}

.label h4 {
		display: inline-block;
		background-color: rgba(0,0,0,0.7);

}

#label1 {
	position: absolute;
	left: 2.5%;
}

#label2 {
	position: absolute;
	left: 27.5%;
}

#label3 {
	position: absolute;
	left: 52.5%;
}

#label4 {
	position: absolute;
	left: 77.5%;
}
</style>
</head>

<body>
<div class="container">

	<div class="question-container">
		<h1 class="question">DO YOU THINK D3 HAS A STEEP LEARNING CURVE ?</h1>
	</div>

	<div class="chart-container">

			<div id="label1" class="label">
				<h4>YES. Stay away from it.</h4>
			</div>
			<div id="label2" class="label">
				<h4>YES. But it is awesome.</h4>
		 </div>
			<div id="label3" class="label">
				<h4>Don't know.</h4>
			</div>
			<div id="label4" class="label">
				<h4>NO. It is pretty easy.</h4>
			</div>

	</div>

</div>


<script>
// helper function to genarate random number in between min-max
function randombetween(min, max) {
    return Math.floor(Math.random() * (max - min + 1) + min);
}

// helper function to shuffle array
function shuffle(array) {
    var currentIndex = array.length,
        temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array;
}

// Algorithm to simulate poll

/*
// create inicial random dataset
var votes = [0, 0, 0, 0];
var dataset = [0, 0, 0, 0];
var dataSize = 4;
var voteRate = 10;

// Algorithm to simulate the further voting process
var updateData = function() {

  var total = 0;
  dataset = [0, 0, 0, 0];

  // add random amount of votes
  for (i = 0; i < dataSize; i++) {
    var randomVotes = randombetween(0, voteRate);
    votes[i] += randomVotes;
    total += votes[i];
  }

  // calculate percentages
  for (i = 0; i < dataSize; i++) {
    dataset[i] = votes[i] / total * 100;
  }

  voteRate *= 1.2;

  drawVis();
  $("svg").fadeIn("slow");
};
*/
var dataset = [];
var max = 100;
var a = randombetween(0, max);
var b = randombetween(0, max - a);
var c = randombetween(0, max - a - b);
var d = max - a - b - c;
dataset.push(a, b, c, d);
console.log(dataset);

// helper function too simulate live data
var updateData = function() {
    dataset = [];
    a = randombetween(0, max);
    b = randombetween(0, max - a);
    c = randombetween(0, max - a - b);
    d = max - a - b - c;
    dataset.push(a, b, c, d);
    shuffle(dataset);
    console.log(dataset);

    drawVis();
    $(".chart-container").fadeIn("slow");
		setTimeout(function(){
			$("svg").fadeIn("slow");
		}, 1000);
};

// simullate live data input
var update = setInterval(updateData, 1750);

//Width and height
var windowWidth = $(window).width();
var windowHeight = $(window).height();
var w = windowWidth;
var h = windowHeight * 80 / 100;
var barPadding = windowWidth * 5 / 100;
var bottomRectHight = w * 3 / 100;
var y = d3.scale.sqrt()
    .range([h, 0])
    .domain([0, 100]); //since values vary between 0 and 100


//Create SVG element
var svg = d3.select(".chart-container")
    .append("svg")
    .attr("width", w)
    .attr("height", h)
    .attr("style", "display:none;");


//Draw static Rectangle for bottom
var rectangle = svg.append("rect")
		.attr("x", 0)
		.attr("y", h - bottomRectHight)
		.attr("width", w)
		.attr("height", bottomRectHight)
		.attr("fill", "rgb(250, 128, 114)");


// create inicial vis
function drawVis() {

    var uSel = svg.selectAll(".input")
        .data(dataset);

    uSel.exit().remove();

    uSel
        .enter()
        .append("rect")
        .attr("class", "input")
        .attr("fill", "rgb(250, 128, 114)");

    uSel
        .attr("x", function(d, i) {
            return i * (w / dataset.length) + 2.5 / 100 * w;
        })
        .attr("width", w / dataset.length - barPadding)
        .attr("height", y(0))
        .transition().duration(1750).ease("linear")
        .attr("y", function(d) {
            return y(d);
        })
        .attr("height", function(d) {
            return h - y(d);
        });



}
</script>

</body>
